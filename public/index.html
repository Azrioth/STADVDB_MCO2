<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Games Reviews</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Steam Games Reviews</h1>

    <div>
        <label for="game-id">Enter Game ID:</label>
        <input type="text" id="game-id" placeholder="Enter AppID">
        <button id="fetch-details">Fetch Details</button>
    </div>

    <h2>Game Details</h2>
    <table id="game-details" border="1">
        <thead>
            <tr>
                <th>Feature</th>
                <th>Content</th>
            </tr>
        </thead>
        <tbody>
            <!-- Game details will be inserted here -->
        </tbody>
    </table>

    <h2>Update Review</h2>
    <form id="update-form">
        <input type="hidden" id="update-AppID" name="AppID">
        <label for="Reviews">Review:</label>
        <input type="text" id="Reviews" name="Reviews" placeholder="Leave blank to skip update">

        <div>
            <form id="ReviewType">
                <label for="review-type-field">Review Type:</label>
                <select id="review-type-field" name="review-type-field">
                    <option></option>
                    <option value="Positive">Positive</option>
                    <option value="Negative">Negative</option>
                </select>
            </form>
        </div>

        <label for="Metacritic_url">Metacritic URL:</label>
        <input type="text" id="Metacritic_url" name="Metacritic_url" placeholder="Leave blank to skip update">

        <label for="Metacritic_score">Metacritic Score:</label>
        <input type="number" id="Metacritic_score" name="Metacritic_score" placeholder="Leave blank to skip update">

        <button type="submit">Update Game</button>
    </form>

    <h2>Delete Review</h2>
    <form id="delete-form">
        <label for="delete-field">Select field to delete:</label>
        <select id="delete-field" name="delete-field">
            <option value="Reviews">Reviews</option>
            <option value="Metacritic_score">Metacritic Score</option>
            <option value="Metacritic_url">Metacritic URL</option>
        </select>
        <button type="submit">Delete Field</button>
    </form>

    <script>
        // Function to update the game details in the table
        function updateTable(gameDetails) {
            const tableBody = document.querySelector('#game-details tbody');
            tableBody.innerHTML = '';  // Clear any existing rows

            // Add new rows with game details
            for (let key in gameDetails) {
                if (gameDetails.hasOwnProperty(key)) {
                    const row = document.createElement('tr');
                    const featureCell = document.createElement('td');
                    const contentCell = document.createElement('td');

                    featureCell.textContent = key;
                    contentCell.textContent = gameDetails[key];

                    row.appendChild(featureCell);
                    row.appendChild(contentCell);
                    tableBody.appendChild(row);
                }
            }
        }

        // Fetch game details based on AppID
        document.getElementById('fetch-details').addEventListener('click', async () => {
            const appID = document.getElementById('game-id').value;
            if (!appID) {
                alert('Please enter a valid game ID!');
                return;
            }

            try {
                const response = await fetch(`/get_game_details/${appID}`);
                const gameDetails = await response.json();

                if (response.ok) {
                    console.log('Game details retrieved successfully:', gameDetails);
                    updateTable(gameDetails);
                    document.getElementById('update-AppID').value = appID;
                } else {
                    alert('Game not found');
                }
            } catch (error) {
                console.error('Error fetching game details:', error);
                alert('Error fetching game details. Please try again later.');
            }
        });

        // Update game details
        document.getElementById('update-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const appID = document.getElementById('update-AppID').value;
            const reviews = document.getElementById('Reviews').value;
            const metacriticUrl = document.getElementById('Metacritic_url').value;
            const metacriticScore = document.getElementById('Metacritic_score').value;
            const reviewType = document.getElementById('review-type-field').value.value;

            const data = { AppID: appID, Reviews: reviews, Metacritic_url: metacriticUrl, Metacritic_score: metacriticScore, ReviewType: reviewType };

            try {
                const response = await fetch('/update_game', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (response.ok) {
                    console.log('Game updated successfully:', result.game);
                    updateTable(result.game);
                } else {
                    alert('Failed to update game');
                }
            } catch (error) {
                console.error('Error updating game:', error);
                alert('Error updating game. Please try again later.');
            }
        });

        // Delete review field
        document.getElementById('delete-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const appID = document.getElementById('update-AppID').value;
            const fieldToDelete = document.getElementById('delete-field').value;

            const data = { AppID: appID, fieldToDelete: fieldToDelete };

            try {
                const response = await fetch('/delete_review', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (response.ok) {
                    console.log('Field deleted successfully:', result.game);
                    updateTable(result.game);
                } else {
                    alert('Failed to delete field');
                }
            } catch (error) {
                console.error('Error deleting field:', error);
                alert('Error deleting field. Please try again later.');
            }
        });
    </script>
</body>
</html>
