<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Games Reviews</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            color: #333;
        }

        form {
            margin-bottom: 20px;
        }

        .game-details {
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .game-details h2 {
            margin-top: 0;
        }

        .game-details p {
            margin: 5px 0;
        }

        .game-details span {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Steam Games Reviews</h1>

    <!-- Game Lookup Section -->
    <form id="game-form">
        <label for="AppID">Enter Game ID:</label>
        <input type="text" id="AppID" name="AppID" required>
        <button type="submit">Fetch Game</button>
    </form>
    <div id="game-details" class="game-details" style="display: none;">
        <h2>Game Details</h2>
        <p><span>Game ID:</span> <span id="game-id"></span></p>
        <p><span>Name:</span> <span id="game-name"></span></p>
        <p><span>Release Date:</span> <span id="release-date"></span></p>
        <p><span>Price:</span> <span id="price"></span></p>
        <p><span>Required Age:</span> <span id="required-age"></span></p>
        <p><span>Achievements:</span> <span id="achievements"></span></p>
        <p><span>Reviews:</span> <span id="reviews"></span></p>
        <p><span>Positive Reviews:</span> <span id="positive-reviews"></span></p>
        <p><span>Negative Reviews:</span> <span id="negative-reviews"></span></p>
        <p><span>Metacritic Score:</span> <span id="metacritic-score"></span></p>
        <p><span>Metacritic URL:</span> <a id="metacritic-url" href="#" target="_blank">Link</a></p>
    </div>

    <!-- Game Update Section -->
    <h2>Update Review</h2>
    <form id="update-form">
        <input type="hidden" id="update-AppID" name="AppID">

        <label for="Reviews">Review:</label>
        <input type="text" id="Reviews" name="Reviews">

        <div>
            <label>
                <input type="radio" name="ReviewType" value="Positive">
                Positive
            </label>
            <label>
                <input type="radio" name="ReviewType" value="Negative">
                Negative
            </label>
        </div>

        <label for="Metacritic_url">Metacritic URL:</label>
        <input type="text" id="Metacritic_url" name="Metacritic_url">

        <label for="Metacritic_score">Metacritic Score:</label>
        <input type="number" id="Metacritic_score" name="Metacritic_score">

        <button type="submit">Update Game</button>
    </form>

    <!-- Delete Field Section -->
    <h2>Delete Review</h2>
    <form id="delete-form">
        <input type="hidden" id="delete-AppID" name="AppID">

        <label for="Field">Select Field to Delete:</label>
        <select id="Field" name="Field">
            <option value="Reviews">Reviews</option>
            <option value="Metacritic_score">Metacritic Score</option>
            <option value="Metacritic_url">Metacritic URL</option>
        </select>
        
        <button type="submit" id="delete-button">Delete Field</button>
    </form>

    <script>
        // Fetch game details
        document.getElementById('game-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const appID = document.getElementById('AppID').value;
            const res = await fetch('/get_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ AppID: appID })
            });
            const data = await res.json();

            if (data.error) {
                alert(data.error);
                document.getElementById('game-details').style.display = 'none';
                return;
            }

            // Populate game details
            document.getElementById('game-id').textContent = data.data.AppID || 'N/A';
            document.getElementById('game-name').textContent = data.data.Game_Name || 'N/A';
            document.getElementById('release-date').textContent = data.data.Release_date
                ? new Date(data.data.Release_date).toISOString().split('T')[0]
                : 'N/A';
            document.getElementById('price').textContent = `$${data.data.Price || 0}`;
            document.getElementById('required-age').textContent = data.data.Required_age || 'N/A';
            document.getElementById('achievements').textContent = data.data.Achievements || 'N/A';
            document.getElementById('reviews').textContent = data.data.Reviews || 'No reviews';
            document.getElementById('positive-reviews').textContent = data.data.Positive_reviews || 0;
            document.getElementById('negative-reviews').textContent = data.data.Negative_reviews || 0;
            document.getElementById('metacritic-score').textContent = data.data.Metacritic_score || 'N/A';
            document.getElementById('metacritic-url').href = data.data.Metacritic_url || '#';
            document.getElementById('metacritic-url').textContent = data.data.Metacritic_url ? 'View Metacritic' : 'No URL';

            // Show the game details section
            document.getElementById('game-details').style.display = 'block';
        });

        // Update game details
        document.getElementById('update-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(document.getElementById('update-form'));
            const jsonData = Object.fromEntries(formData.entries());
            const res = await fetch('/update_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(jsonData)
            });
            alert(await res.text());
        });

        // Delete field
        document.getElementById('delete-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(document.getElementById('delete-form'));
            const jsonData = Object.fromEntries(formData.entries());
            const res = await fetch('/delete_field', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(jsonData)
            });
            alert(await res.text());
        });
    </script>    
</body>
</html>
